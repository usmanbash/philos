{%- doc -%}
  Renders the back-in-stock modal.
{%- enddoc -%}

{%- liquid
  # Parameter validation and defaults
-%}
<div
  x-show='$store.backInStock.isModalOpen'
  role='dialog'
  aria-modal='true'
  aria-labelledby='modal-title'
  class='fixed inset-0 z-100 overflow-y-auto'>
  
  {% comment %} modal-backdrop {% endcomment %}
  <div
    x-cloak
    x-show='$store.backInStock.isModalOpen'
    @click='$store.backInStock.closeModal()'
    x-transition:enter='transition ease-out duration-300 transform'
    x-transition:enter-start='opacity-0'
    x-transition:enter-end='opacity-100'
    x-transition:leave='transition ease-in duration-200 transform'
    x-transition:leave-start='opacity-100'
    x-transition:leave-end='opacity-0'
    aria-hidden='true'
    class='modal__backdrop fixed inset-0 transition-opacity bg-black/25'></div>

  <div class='flex items-center justify-center min-h-screen px-4 sm:p-0'>
    <div
      x-cloak
      x-show='$store.backInStock.isModalOpen'
      x-transition:enter='transition ease-out duration-300 transform'
      x-transition:enter-start='opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95'
      x-transition:enter-end='opacity-100 translate-y-0 sm:scale-100'
      x-transition:leave='transition ease-in duration-200 transform'
      x-transition:leave-start='opacity-100 translate-y-0 sm:scale-100'
      x-transition:leave-end='opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95'
      class='modal_panel w-full max-w-[720px] my-20 overflow-hidden transition-all transform bg-white rounded-lg shadow-xl'>
      
      {% comment %} content layout {% endcomment %}
      <div class='feature-content relative flex md:flex-row md:items-stretch'>
        
        {% comment %} image {% endcomment %}
        <div class='hidden md:block md:w-2/5 bg-gray/10'>
          <div
            x-if="variantImageSrc"
            class="relative w-full aspect-[0.7]">
            <img
              :src="variantImageSrc" 
              :alt="variantName"
              class="w-full h-full object-cover">
          </div>
        </div>

        {% comment %} content {% endcomment %}
        <div class='w-full md:w-3/5 flex flex-col'>
          {% comment %} modal-header {% endcomment %}
          <div class='flex justify-end px-6 py-2'>
            <button
              type='button'
              aria-label='Close'
              class='ml-auto'
              @click='$store.backInStock.closeModal()'>
              <span class='link link--line text-16'>Close</span>
            </button>
          </div>

          {% comment %} content {% endcomment %}
          <div class='flex-1 flex flex-col gap-4 justify-between px-6 py-6'>
            <div class="">
              <h2 class='text-24 lg:text-30 font-ivar mb-4'>{{ 'bis.modal_title' | t | default: 'Email me when this is back' }}</h2>
              <p class='text-16'>{{ 'bis.modal_text' | t | default: 'Enter your email address below to receive a notification when this product is next available.' }}</p>
              {% comment %} product {% endcomment %}
              <div class="flex items-center gap-2 my-8">
                <p class="text-16 " x-text="variantName" />
              </div>
            </div>

            <div 
              x-show="!isSuccess"
              class="">
              {% comment %} Back in stock form {% endcomment %}
              {% render 'back-in-stock-form' %}
            </div>

            <div 
              x-show="isSuccess"
              class="">
              <h3 class="text-20 font-ivar mb-4">{{ 'bis.thank_you_title' | t | default: 'Thank you!' }}</h3>
              <p class="text-16 mb-8">{{ 'bis.thank_you_text' | t | default: 'You will be notified when this product is back in stock.' }}</p>
              <button
                type='button'
                aria-label='Close'
                class='ml-auto'
                @click='$store.backInStock.closeModal()'>
                <span class='link link--line text-16'>Close</span>
              </button>
            </div>
            
          </div>
        </div>
      </div>
    </div>
  </div>
</div>