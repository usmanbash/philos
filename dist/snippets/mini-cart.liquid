{%- comment -%}
Snippet: Mini Cart
Description: A snippet that displays the mini cart with line items and cart controls
{%- endcomment -%}

{% liquid
  assign flex_vertical = ''
  assign lg_width = ''
  if vertical == true
    assign flex_vertical = 'px-5 sm:px-10 md:flex-row md:gap-6 lg:gap-12'
    assign lg_width = 'w-full md:w-3/4 md:border-t md:border-b md:border-gray'
  endif
%}

<div
  x-data='miniCart({
    cart: {{ cart | json | escape }}
  })'
  @update-cart.window='getCart()'
  @update-cart-items.window='getCart()'
  {% if preventScroll == true %} data-lenis-prevent {% endif %}
  class="mini-cart  pb-10 md:px-10 h-full text-16 flex justify-between items-start flex-col text-black {{ flex_vertical }}">
  <div class="flex flex-col overflow-hidden {{ lg_width }}">

    {% if showTitle == true %}
      <h2 class="text-46 font-ivar mb-8 mt-8">{{ 'cart.title' | t }}</h2>
    {% endif %}

    <div
      {% if preventScroll == true %} data-lenis-prevent {% endif %}
      class="overflow-y-auto">
      {%- comment -%}Fallback for empty cart{%- endcomment -%}
      <template x-if="lineItems.length == 0">
        <p class="py-5 text-16">{{ 'cart.empty' | t }}</p>
      </template>
      {%- comment -%}Cart items{%- endcomment -%}
      <template x-for="lineItem in lineItems">
        {% render 'line-item',
          vertical: vertical,
          lineItem: lineItem,
          showTotalPrice: showTotalPrice
          cart: cart
        %}
      </template>
    </div>
  </div>

  <div
    {% if vertical == true %} class='w-full md:w-1/4 mt-10 md:mt-0' {% endif %}
    class='w-full'>
    {%- unless vertical == true -%}
      <div class="mt-auto">
        <div class="mb-8">
          {% render 'free-shipping-progress-bar' %}
        </div>
        {%- comment -%} Render the recommendations {%- endcomment -%}
        {%- assign title = 'cart.recommended' | t -%}
        {% render 'mini-cart-recommendations', title: title %}
      </div>
    {%- endunless -%}
    {%- comment -%} Render the cart controls {%- endcomment -%}
    {% render 'cart-controls', cart: cart, viewBag: viewBag %}
  </div>

</div>
