{% comment %}
  Snippet: seen-on-you.liquid
  Description: 
    Renders a seen-on-you section with a slider
  
  Parameters:
    - title: Section title
    - mode: 'auto' or 'manual'
    - manual_items: list of metaobjects (seen_on)
    - limit: maximum number of items to display
    - is_product: boolean (default: false)

{% endcomment %}

{% liquid
  assign max = limit | default: 8
  assign slides_per_view_lg = 4

  # Determine if product page
  assign isProduct = is_product
  if is_product == blank
    if product
      assign isProduct = true
    else
      assign isProduct = false
    endif
  endif

  # If product page, set slides_per_view_lg to 3
  if isProduct
    assign slides_per_view_lg = 3
  endif

  # if mode is manual, use manual_items
  if mode == 'manual'
    assign items = manual_items
  else
    assign items = shop.metaobjects.seen_on.values | shuffle
  endif

  # randomize items
  # assign items = items | shuffle

  # Get current product ID for filtering if on product page
  if isProduct and product
    assign current_product_id = product.id
  endif

  # enable / disable filtering by product
  assign should_filter = false
%}

<div class="seen-on-you-slider relative w-full">

  {% capture header %}
    {%- render 'slider-navbar',
      title: title,
      slider_navbar_class: 'px-5 sm:px-0'
    -%}
  {% endcapture %}

  {% capture slides %}
    {% assign rendered_count = 0 %}
    {% for item in items %}
      {% comment %} Skip if we've reached the limit {% endcomment %}
      {% if max != blank and rendered_count >= max %}
        {% break %}
      {% endif %}
      
      {% comment %} Skip if filtering by product and item doesn't reference current product {% endcomment %}
      {% if current_product_id and should_filter %}
        {% assign product_references = item.product_references.value %}
        {% assign item_matches_product = false %}
        {% for ref_product in product_references %}
          {% if ref_product.id == current_product_id %}
            {% assign item_matches_product = true %}
            {% break %}
          {% endif %}
        {% endfor %}
        {% unless item_matches_product %}
          {% continue %}
        {% endunless %}
      {% endif %}

      <div class="swiper-slide">
        {% render 'seen-on-you-card', item: item %}
      </div>
      {% assign rendered_count = rendered_count | plus: 1 %}
    {% endfor %}
  {% endcapture %}

  {% render 'card-slider',
    header: header,
    slides: slides,
    slides_per_view_lg: slides_per_view_lg
  %}
</div>
